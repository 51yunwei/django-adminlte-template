{% extends 'base.html' %} 
{% load static %}                                 
{% block head %}
{% endblock %}
{% block pageheader %}系统管理{% endblock %}
{% block content %}
<section class="content">
    <div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
        <div class="card card-info">
            <div class="card-header">
            <h3 class="card-title">系统设置</h3>
            </div>
            <form class="form-horizontal" id='systemForm' novalidate="novalidate">
            <div class="card-body">
            <div class="form-group row">
            <label for="title" class="col-sm-2 col-form-label"><a style="color: red;">*</a> Tilte</label>
            <div class="col-sm-10">
            <input type="text" class="form-control" id="title" name="title" placeholder="网页title" value="{{ systeminfo.system_title }}">
            </div>
            </div>
            <div class="form-group row">
            <label for="systemname" class="col-sm-2 col-form-label"><a style="color: red;">*</a> 系统名称</label>
            <div class="col-sm-10">
            <input type="text" class="form-control" id="systemname" name="systemname" placeholder="系统名称" value="{{ systeminfo.system_name }}">
            </div>
            </div>
            <div class="form-group row">
            <div class="offset-sm-2 col-sm-10">
            </div>
            </div>
            </div>
            
            <div class="card-footer">
            <button type="submit" class="btn btn-info">保存&提交</button>
            <a href="javascript:history.go(-1);" class="btn btn-success float-right"></i> 取消</a>
            </div>
            
            </form>
            </div>
        </div>
    </div>
    
    </div>
    </section>
{% endblock %}
{% block script %}
<script>
    $(document).ready(function(){
        var Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000
        });
        $("#systemForm button[type='submit']").click(function(e){
            e.preventDefault(); // 阻止表单的默认提交行为
            // 先进行表单验证
            if (!$("#systemForm").valid()) {
                // 如果验证失败，返回false，不提交数据
                return false;
            };
            var formData = $("#systemForm").serialize();
            $.ajax({
                url: "{% url 'manager:system' %}", // 你的请求地址
                type: "POST", // 请求类型，必须是POST
                data: formData, // 你的表单数据
                dataType: "json", // 返回的数据类型，必须是json
                success: function(data){
                    if (data.result === 0) {
                        // 请求成功，显示消息
                        toastr.success(data.message)
                        setTimeout(function() {
                            location.reload();
                        }, 1000);
                    } else if (data.result === 1) {
                        toastr.error(data.message)
                    }
                },
                error: function(){
                    // 请求失败的回调函数
                    console.log("Error");
                }
            });
        });
        // 表单验证
        // $("#savebtn").prop('disabled', true);
    $('#systemForm').validate({
          rules: {
            title: {
              required: true,
            },
            systemname: {
              required: true,
            },
          },
          messages: {
            title: {
              required: "title不能为空",
            },
            systemname: {
              required: "系统名称不能为空",
            },
          },
          errorElement: 'span',
          errorPlacement: function (error, element) {
            error.addClass('invalid-feedback');
            element.closest('.form-group').append(error);
           
          },
          highlight: function (element, errorClass, validClass) {
            $(element).addClass('is-invalid');
           
          },
          unhighlight: function (element, errorClass, validClass) {
            $(element).removeClass('is-invalid');
          },
          
        });
    });
    </script>
{% endblock %}